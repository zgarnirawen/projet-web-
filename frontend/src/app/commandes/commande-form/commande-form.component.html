<div class="form-page">
  <div class="form-container">
    <div class="form-header">
      <h2>{{ isEditMode ? 'Modifier' : 'Nouvelle' }} Commande</h2>
      <span class="icon">ðŸ“‹</span>
    </div>

    <div class="form-body">
      <div class="info-card">
        <p>{{ isEditMode ? 'Modifiez les informations de la commande' : 'Remplissez les informations de la nouvelle commande' }}</p>
      </div>

      <form (ngSubmit)="save()">
        <div class="form-row">
          <div class="form-group">
            <label for="id">
              NÂ° Commande <span class="required">*</span>
            </label>
            <input
              id="id"
              type="number"
              [(ngModel)]="commande.id"
              name="id"
              placeholder="1"
              min="1"
              required
            />
          </div>

          <div class="form-group">
            <label for="idClient">
              ID Client <span class="required">*</span>
            </label>
            <input
              id="idClient"
              type="number"
              [(ngModel)]="commande.idClient"
              name="idClient"
              placeholder="101"
              min="1"
              required
            />
          </div>
        </div>

        <!-- Lignes de commande -->
        <div class="lignes-section">
          <div class="section-header">
            <h3>Articles commandÃ©s</h3>
            <button type="button" class="btn-add-ligne" (click)="ajouterLigne()">
              + Ajouter un article
            </button>
          </div>

          <div class="lignes-list" *ngIf="commande.lignes.length > 0">
            <div class="ligne-item" *ngFor="let ligne of commande.lignes; let i = index">
              <div class="ligne-fields">
                <div class="form-group">
                  <label>Article <span class="required">*</span></label>
                  <select
                    [(ngModel)]="ligne.article"
                    [name]="'article-' + i"
                    (change)="onArticleChange(i)"
                    required
                  >
                    <option value="">SÃ©lectionner un article</option>
                    <option *ngFor="let art of articles" [value]="art.designation">
                      {{ art.designation }} (Stock: {{ art.quantite }})
                    </option>
                  </select>
                </div>

                <div class="form-group">
                  <label>QuantitÃ© <span class="required">*</span></label>
                  <input
                    type="number"
                    [(ngModel)]="ligne.quantite"
                    [name]="'quantite-' + i"
                    placeholder="1"
                    min="1"
                    [max]="getArticleStock(ligne.article)"
                    required
                  />
                  <small *ngIf="ligne.article" class="stock-info">
                    Stock disponible: {{ getArticleStock(ligne.article) }}
                  </small>
                </div>

                <div class="form-group">
                  <label>Prix unitaire <span class="required">*</span></label>
                  <input
                    type="number"
                    [(ngModel)]="ligne.prix"
                    [name]="'prix-' + i"
                    placeholder="0.00"
                    min="0"
                    step="0.01"
                    required
                    readonly
                  />
                </div>

                <button 
                  type="button" 
                  class="btn-remove-ligne" 
                  (click)="supprimerLigne(i)"
                  title="Supprimer cette ligne"
                >
                  âœ•
                </button>
              </div>
            </div>
          </div>

          <div class="empty-state" *ngIf="commande.lignes.length === 0">
            <p>Aucun article ajoutÃ©. Cliquez sur "Ajouter un article" pour commencer.</p>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="annuler()">
            âœ• Annuler
          </button>
          <button type="submit" class="btn btn-primary">
            âœ“ {{ isEditMode ? 'Mettre Ã  jour' : 'Enregistrer' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
